<!DOCTYPE html>
<html lang="en">
<head>
    <base href="<%= BASE_URL %>">
    <meta charset="UTF-8">
    <title>EarSketch</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <script type="text/javascript" src="scripts/vendor/newrelic/newrelicbrowser.<%= BUILD_CONFIG %>.js"></script>

    <!-- Suppress favicon error -->
    <link rel="shortcut icon" href="favicon.ico">

    <!-- Angular UI Layout -->
    <link rel="stylesheet" type="text/css" href="scripts/lib/ui-layout.css">

    <!-- Google Font -->
    <link rel="stylesheet" type="text/css" href="fonts/lato/lato.css">
    <link rel="stylesheet" type="text/css" href="fonts/roboto/roboto.css">
    <link rel="stylesheet" type="text/css" href="fonts/hack/css/hack.css">

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" type="text/css" href="css/vendor/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="css/vendor/bootstrap-glyphicons.css">

    <!-- Icon Moon -->
    <link rel="stylesheet" type="text/css" href="fonts/icomoon_ultimate/style.css">

    <!-- highlight js style -->
    <link rel="stylesheet" type="text/css" href="scripts/lib/jsdifflib/diffview.css">

    <link rel="stylesheet" type="text/css" href="css/vendor/colpick.css" />

    <meta name="google-site-verification" content="ojwZ1r7MVOTRWsiqPITqwmhCOUou2CcqxRMG6itoci4"/>
</head>
<body ng-controller="mainController as mainCtrl" ng-init="init()" ng-keydown="keydownES($event)">
<!--<div id="root"></div>-->
<!--<root-component/>-->

<!-- dynamically set the color theme -->
<link rel="stylesheet" type="text/css" ng-href="css/earsketch/theme_{{colorTheme}}.css">

<!-- highlight js style -->
<link rel="stylesheet" type="text/css" ng-href="scripts/lib/highlightjs/styles/{{hljsTheme}}.css">

<div id="screen" class="loader">
    <br/><br/><br/><br/><br/><br/>
    <div class="text-5xl text-center pb-16" style="font-size: 3rem; padding-bottom: 4rem;">Loading EarSketch...</div>
    <div class="loading-spinner"></div>
</div>
<script>
    // dark loading screen -- since angular is loaded much later, CSS file swapping will be too late to change the color of the loading screen
    if (localStorage['colorTheme'] === 'dark') {
        document.body.style['background-color'] = '#000'
    } else {
        document.getElementsByClassName('loader')[0].style['background-color'] = '#EEE';
        document.getElementsByClassName('loader')[0].style['color'] = '#4e4e4e';
        document.body.style['background-color'] = '#EEE'
    }
</script>

<script type="text/javascript" src="/curriculum/curr_toc.js"></script>
<script type="text/javascript" src="/curriculum/curr_pages.js"></script>
<script type="text/javascript" src="/curriculum/curr_searchdoc.js"></script>

<div id="notification-history" ng-show="showNotificationHistory">
    <div style="padding:1em; display:flex; justify-content:space-between;">
        <div>
            <a href="#" ng-click="toggleNotificationHistory(false)">
                <i id="back-button" class="icon icon-arrow-right22"></i>
            </a>
            <span style="color:grey;">
                <i class="icon icon-bell"></i> Notifications
            </span>
        </div>
        <div>
            <a style="color:#d04f4d; cursor:pointer;" class="closemodal buttonmodal" ng-click="toggleNotificationHistory(false)"><span><i class="icon icon-cross2"></i></span>CLOSE</a>
        </div>
    </div>

    <div class="notification-type-header">Pinned Notifications</div>
    <div ng-repeat="item in notificationList track by $index" ng-if="item.notification_type === 'broadcast' || item.notification_type === 'teacher_broadcast'">
        <div style="margin:10px 20px;">
            <div style="display:flex; align-items:center; float:left; margin: 10px; margin-left: 0;">
                <div><i class="icon icon-pushpin"></i></div>
            </div>
            <div style="display:flex; justify-content:space-between;">
                <div>
                    <div>
                        {{item.message.text}}
                    </div>
                    <div style="font-size:10px; color:grey;">
                        {{currentTime - item.time | formatTimer}}
                    </div>
                </div>
                <div ng-if="!!item.message.hyperlink">
                    <a ng-href="{{item.message.hyperlink}}" target="_blank" style="cursor:pointer;">MORE</a>
                </div>
            </div>
        </div>
        <hr style="margin:10px 20px; border: solid 1px dimgrey;" ng-show="$index < notificationList.length-1">
    </div>

    <div class="notification-type-header" style="display:flex; justify-content:space-between;">
        <div>Other Notifications</div>
        <div><a href="#" ng-click="markAllAsRead()">MARK ALL AS READ</a></div>
    </div>
    <div ng-repeat="item in notificationList track by $index" ng-if="item.notification_type !== 'broadcast' && item.notification_type !== 'teacher_broadcast'">
        <div style="margin:10px 20px; cursor:pointer;" ng-click="readMessage($index, item)">
            <div style="display:flex; align-items:center; float:left; margin: 10px; margin-left: 0;">
                <div class="marker" ng-show="item.unread"></div>
                <div class="empty-marker" ng-hide="item.unread"></div>
            </div>
            <div style="display:flex; justify-content:space-between;">
                <div>
                    <div>
                        {{item.message.text}}
                    </div>
                    <div style="font-size:10px; color:grey;">
                        {{currentTime - item.time | formatTimer}}
                    </div>
                </div>
                <div ng-if="item.notification_type === 'share_script'">
                    <span ng-click="openSharedScript(item.shareid)"><a href="#" style="cursor:pointer;">OPEN</a></span>
                </div>
            </div>
        </div>
        <hr style="margin:10px 20px; border: solid 1px dimgrey;" ng-show="$index < notificationList.length-1">
    </div>
</div>

<div id="download-loader" ng-click='downloadSpinnerClick()'>
    <br/><br/><br/><br/><br/><br/>
    <h2><i class="spinner icon icon-spinner"></i> Preparing your download</h2>
</div>

<div class="flex flex-col justify-start h-screen max-h-screen">
    <div id="top-header-nav" ng-show="!isEmbedded">
        <div id="top-header-nav-left">
            <div id="app-title-container" class="pull-left">
                <img id="app-logo" src="img/ES_logo_extract.svg" alt="EarSketch Logo">
                <a href="http://earsketch.gatech.edu/landing" target='_blank' id="app-title">EarSketch</a>
            </div>

            <div id="top-header-nav-links" class="pull-left" style="max-width: 500px;">
                <div><a href="https://www.amazonfutureengineer.com/earsketch" target='_blank' ng-show="showAmazonBanner" id="app-title" style="color:yellow; text-shadow: 1px 1px #FF0000; line-height: 21px;">
                    <div><img id="app-logo" src="img/afe_logo.png" alt="Amazon Logo" style="margin-left: 17px; margin-right: 0px; height: 13px;"></div>
                    Celebrity Remix</a>
                </div>
            </div>
            <div class="clear:both"></div>
        </div>

        <!-- temporary place for the app-generated notifications -->
        <notification-bar ng-show="showText"></notification-bar>

        <!-- top-right icons -->
        <div id="top-header-nav-form">
            <!-- CAI-window toggle -->
            <button ng-if="enableCAI" class="top-header-nav-button btn" ng-style="{color:showCAIWindow?'white':'#939393'}" ng-click="toggleCAIWindow()" data-toggle="tooltip" title="CAI">
                <i class="icon icon-bubbles"></i>
            </button>

            <!-- keyboard shortcuts -->
<!--            <div>-->
<!--                <button id="keyboard-shortcuts" type="button" class="top-header-nav-button btn btn-xs btn-clear" ng-click="toggleShortcutHelper()" ng-class="showKeyShortcuts ? 'grow-in-size':''" title="Show/Hide Keyboard Shortcuts">-->
<!--                    <i class="icon icon-keyboard"></i>-->
<!--                    <span class="sr-only">Keyboard Shortcuts</span>-->
<!--                </button>-->
<!--            </div>-->

            <!-- Font Size -->
            <div uib-dropdown dropdown-append-to-body>
                <button uib-dropdown-toggle type="button" id="font-size-button" class="top-header-nav-button btn btn-xs btn-clear dropdown-toggle">
                    <i class="icon icon-font-size2"></i>
                </button>
                <ul uib-dropdown-menu class="dropdown-menu text-left font-size-menu" role="menu">
                    <li ng-repeat="size in fontSizes" >
                        <a ng-click="setFontSize(size.size)">{{size.size}} <span ng-if="size.size === 14">(Default)</span> <i ng-if="selectedFont === size.size" class="animate-if icon icon-checkmark4"></i></a>
                    </li>
                </ul>
            </div>

            <!-- global options -->
            <div  uib-dropdown dropdown-append-to-body class="btn-group">
                <button uib-dropdown-toggle type="button" class="top-header-nav-button btn btn-xs btn-clear dropdown-toggle" id="global-options">
                    <i class="icon icon-cog2"></i>
                    <span class="caret"></span>
                    <span class="sr-only">Toggle Dropdown</span>
                </button>
                <ul uib-dropdown-menu class="dropdown-menu dropdown-menu-right" role="menu" style="max-height:300px; height:auto; overflow-y:auto">
                    <li><a href="#" ng-click="resumeQuickTour()">Start Quick Tour</a></li>
                    <li><a href="#" ng-click="toggleColorTheme()">Switch Background Color</a></li>
                    <li ng-show="loggedIn"><a href="#" ng-click="toggleTimesyncOption()"><i ng-if="showTimesync" class="icon icon-checkmark4"> </i>Show "Play Together" Button</a></li>
                    <li><a href="#" ng-click="reportError()">Report Error </a></li>
                </ul>
            </div>

            <!-- notification (bell) button -->
            <div class="user-notification">
                <div id="bell-icon-container" class=".btn" type="button" popover-placement="bottom-right" popover-trigger="outsideClick" popover-is-open="showNotification" uib-popover-template="'templates/user-notification.html'">
                    <i class="icon icon-bell" id="user-notification-icon"></i>
                    <div id="badge" ng-show="getNumUnread() > 0">{{getNumUnread()}}</div>
                </div>
                <notification-popup ng-show="showPopupText"></notification-popup>
            </div>

            <!-- user login menu -->
            <div uib-dropdown dropdown-append-to-body id="not-logged-in" ng-show="!loggedIn">
                <input type="text" autocomplete="on" name = "username" ng-model="username" placeholder="Username" ng-keydown="enterKeySubmit($event)">
                <input type="password" autocomplete="current-password" ng-model="password" placeholder="Password" ng-keydown="enterKeySubmit($event)">
                <button type="submit" ng-click="openShareAfterLogin();login();" class="btn btn-xs btn-default" style="margin-left:6px;padding:2px 5px 3px;"><i class="icon icon-arrow-right"></i></button>
                <button uib-dropdown-toggle type="button" class="btn btn-xs btn-default dropdown-toggle" style="float:right;margin-left:6px;height:23px;">Create / Reset Account </button>
                <ul uib-dropdown-menu class="dropdown-menu dropdown-menu-right" role="menu">
                    <li><a href="#" class="credentials" ng-click="createAccount()">Register a New Account</a></li>
                    <li><a href="#" class="credentials" ng-click="forgotPass()">Forgot Your Password?</a> </li>
                </ul>
            </div>
            <div uib-dropdown dropdown-append-to-body id="logged-in" ng-show="loggedIn">
                <span class="loggedInMsg"></span>
                <button uib-dropdown-toggle type="button" class="btn btn-xs btn-default dropdown-toggle" style="margin-left:6px;"><em style="color:#0078e0;">{{loggedInUserName}}</em>
                    &nbsp;<span class="caret"></span>
                </button>
                <ul uib-dropdown-menu class="dropdown-menu  dropdown-menu-right" role="menu">
                    <li><a href="#" class="credentials" ng-click="editProfile()">Edit Profile</a></li>
                    <li><a type="button" ng-show="userrole == 'admin'" ng-click="openAdminWindow()">Admin Window</a></li>
                    <li><a type="button" ng-click="logout()">Logout</a></li>
                </ul>
            </div>
        </div>
    </div>

    <div class="flex-grow flex flex-row h-full overflow-hidden">
        <div id="main-container" ng-controller="ideController" ng-show="showIDE || showAll" ng-style="dynamicStyle(isEmbedded)"> <!-- container -->
            <div ng-controller="layoutController" class="h-full">
                <!-- dummy -->
                <div class="hidden" ui-layout="" ui-layout-loaded></div>

                <div id="layout-container" class="flex flex-row h-full">
                    <div class="split" id="sidebar-container" ng-style="{'z-index':bubble.active&&[5,6,7,9].includes(bubble.currentPage)?35:0}">
                        <div class="overflow-hidden" id="sidebar"> <!-- re:overflow, split.js width calculation can cause the width to spill over the parent width -->
                            <content-manager></content-manager>
                        </div>
                    </div>

                    <div class="split flex flex-col" id="content">
                        <div class="split" id="devctrl" ng-show="showIDE || showAll">
                            <div class="h-full max-h-full" id="workspace" ng-hide="showIDE && showAll">
                                <div class="loading text-center h-full w-full flex items-center justify-center" ng-show="!loaded && !(showIDE && showAll)">
                                    <i class="spinner icon icon-spinner"></i> &nbsp; Loading...
                                </div>

                                <div class="workstation h-full w-full" ng-show="loaded">
                                    <daw ng-model="compiled"></daw>
                                </div>
                            </div>
                        </div>

                        <div class="split flex flex-col" id="coder" ng-style="{'z-index':bubble.active&&[1,2,9].includes(bubble.currentPage)?35:0}" ng-controller="tabController" ng-show="!hideEditor">
                            <editor-header></editor-header>

                            <div class="flex-grow h-full overflow-y-hidden">
                                <div class="h-full flex flex-col" ng-hide="tabs.length === 0">
                                    <script-tabs></script-tabs>
                                    <div ng-show="isEmbedded" class="embedded-script-info h-auto" >
                                        <p>Script: {{embeddedScriptName}}</p>
                                        <p>By: {{embeddedScriptUsername}}</p>
                                    </div>

                                    <div editor class="flex flex-grow h-full max-h-full overflow-y-hidden"></div>
                                </div>

<!--                                <span ng-show="isEmbedded" class="embedded-script-info" style="padding-top: 5px;"> Script: {{embeddedScriptName}}</span>-->

                                <div class="h-full flex flex-col justify-evenly text-4xl" ng-hide="tabs.length !== 0" style="text-align: center">
                                    <div class="leading-relaxed">
                                        <div id="no-scripts-warning">You have no scripts loaded.</div>
                                        <a href="#" ng-click="createScript()">Click here to create a new script!</a>
                                    </div>

                                    <div class="leading-relaxed empty-script-lang-message">
                                        <p>You are currently in <span class="empty-script-lang">{{dispLang === 'python' ? 'Python' : 'JavaScript'}}</span> mode.</p>
                                        <p>If you want to switch to <span class="empty-script-lang">{{dispLang === 'python' ? 'JavaScript' : 'Python'}}</span> mode, <br>
                                            please open a script with <span class="empty-script-lang">{{dispLang === 'python' ? '.js' : '.py'}}</span> or create a new one <br>
                                            and select <span class="empty-script-lang">{{dispLang === 'python' ? 'JavaScript' : 'Python'}}</span> as the script language.</p>
                                    </div>
                                </div>

                                <iframe id="ifmcontentstoprint" style="height: 0px; width: 0px; visibility:hidden; position: absolute"></iframe>
                            </div>
                        </div>

                        <div class="split" id="console-frame" ng-style="{'z-index':bubble.active&&[9].includes(bubble.currentPage)?35:0}">
                            <div class="results">
                                <div class="row">
                                    <div id="console">
                                        <div class="console-line" ng-repeat="msg in logs track by $index">
                                            <span class="console-info" ng-if="msg.level == 'status'">
                                                {{msg.text}}&nbsp;
                                            </span>
                                            <span class="console-info" ng-if="msg.level == 'info'">
                                                {{msg.text}}&nbsp;
                                            </span>
                                            <span class="console-warn" ng-if="msg.level == 'warn'">
                                                {{msg.text}}
                                            </span>
                                            <span class="console-error" ng-if="msg.level == 'error' && layout['curriculum']">
                                                {{msg.text}}
                                                <a style="cursor:pointer" ng-click="loadChapterForError(msg.text)">
                                                    Click here for more information.
                                                </a>
                                            </span>
                                            <span class="console-error" ng-if="msg.level == 'error' && !layout['curriculum']">
                                                {{msg.text}}
                                                <a style="cursor:pointer" ng-click="loadChapterForError(msg.text); toggleLayout('curriculum')">
                                                    Click here for more information.
                                                </a>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="split" id="curriculum-container" ng-style="{'z-index':bubble.active&&[8,9].includes(bubble.currentPage)?35:0}"> <!-- curriculum -->
                        <div class="h-full" ng-show="!showChatWindow && !showCAIWindow">
                            <curriculum style="height:inherit"></curriculum>
                        </div>
                        <div chatwindow id="chat-window" ng-show="showChatWindow"></div>
                        <div caiwindow ng-if="enableCAI" id="chat-window" ng-show="showCAIWindow"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <app-footer></app-footer>
</div>

<hot-bubble></hot-bubble>
<script-dropdown-menu></script-dropdown-menu>
</body>
</html>