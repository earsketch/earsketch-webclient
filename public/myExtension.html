<div>Hello, World!</div>
<div>This is an iframe! :)</div>
<button>SUMMON AI</button>
<div id="output"></div>
<script>
    // Setup code we can provide in the form of a module or external script
    let hostWindow = null
    let resolver = null

    const earsketch = {
        getEditorContents() {
            hostWindow.postMessage(JSON.stringify({
                fn: 'getEditorContents',
            }))
            return new Promise(resolve => { resolver = resolve })
        }
    }

    window.onmessage = (event) => {
        console.log("message from host:", event.data)
        if (event.data === 'init') {
            hostWindow = event.source
            earsketch.onload()
        } else if (resolver) {
            resolver(JSON.parse(event.data))
        }
    }
</script>
<script>
    // Here's what the extension writer will actually do...
    earsketch.onload = async () => {
        document.querySelector("button").addEventListener("click", async () => {
            const contents = await earsketch.getEditorContents()
            console.log("editor contents:", contents)
            const start = Math.floor(Math.random() * contents.length)
            document.querySelector("#output").innerText = "LLM sez: " + [...contents.substring(start, start + 20)].reverse().join("")
        })
    }
</script>
